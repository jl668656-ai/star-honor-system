<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    
    <title>ğŸ¦ è£è€€ç³»ç»Ÿ App</title>
    
    <link rel="apple-touch-icon" href="https://github.githubassets.com/images/icons/emoji/unicode/1f981.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: radial-gradient(circle at 20% 20%, #eef3ff, #f9fbff 35%, #f4f6f9 70%);
            --card: #ffffff;
            --shadow: 0 10px 24px rgba(0,0,0,0.08);
            --primary: #2c3e50;
            --primary-2: #4ca1af;
            --success: #27ae60;
            --danger: #c0392b;
            --info: #2980b9;
            --muted: #7f8c8d;
        }

        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans SC', 'Avenir Next', system-ui, sans-serif;
            background: #f2f2f7;
            text-align: center;
            padding: 15px;
            padding-top: env(safe-area-inset-top, 20px);
            padding-bottom: env(safe-area-inset-bottom, 20px);
            max-width: 100%;
            margin: 0;
            color: #1c1c1e;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        h1 { color: var(--primary); text-shadow: 1px 1px #bdc3c7; letter-spacing: 1px; }
        h2 { margin-top: 40px; }

        /* æ ¸å¿ƒåˆ†æ•°æ¿ */
        #score-board {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            margin: 15px 0 20px;
            border: none;
            position: sticky;
            top: env(safe-area-inset-top, 10px);
            z-index: 100;
            width: calc(100% - 30px);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        #total-stars { font-size: 60px; font-weight: 800; }
        #rank-title { font-size: 18px; font-weight: 700; opacity: 0.95; }
        .label { font-size: 18px; opacity: 0.9; }

        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        th, td { padding: 14px 10px; border-bottom: 1px solid #f2f2f7; font-size: 15px; }
        th { letter-spacing: 0.3px; font-weight: 600; }
        td { line-height: 1.4; }

        /* æŒ‰é’®é€šç”¨ */
        button {
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            transition: transform 0.1s ease, box-shadow 0.15s ease;
            color: white;
            font-weight: 600;
            letter-spacing: 0.3px;
            -webkit-tap-highlight-color: transparent;
            min-height: 44px;
            touch-action: manipulation;
        }
        button:active { transform: scale(0.94); }
        @media (hover: hover) {
            button:hover { box-shadow: 0 6px 14px rgba(0,0,0,0.15); }
        }

        /* ğŸŸ¢ æ­£å‘è¡Œä¸ºï¼ˆåŠ åˆ†ï¼‰ */
        .task-header { background-color: var(--success); color: white; }
        .btn-add { background-color: var(--success); box-shadow: 0 4px #1e8449; }
        .btn-crit { background-color: #e67e22; box-shadow: 0 4px #b35815; }

        /* ğŸ”´ è´Ÿé¢è¡Œä¸ºï¼ˆæ‰£åˆ†ï¼‰ */
        .penalty-header { background-color: var(--danger); color: white; }
        .btn-minus { background-color: var(--danger); box-shadow: 0 4px #922b21; }

        /* ğŸ”µ ç‰¹æƒå•†åº— */
        .store-header { background-color: var(--info); color: white; }
        .btn-buy { background-color: var(--info); box-shadow: 0 4px #1f618d; }
        .btn-buy.disabled { background-color: #bfc5cc; box-shadow: none; cursor: not-allowed; color: #f5f7fa; }

        .category {
            background-color: #ecf0f1;
            font-weight: bold;
            color: var(--muted);
            text-align: left;
            padding-left: 20px;
        }

        /* ä»»åŠ¡å‘å¸ƒåŒº */
        #task-publisher {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 18px;
            border-radius: 18px;
            margin: 15px 0;
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }
        #task-publisher h3 { color: white; margin-top: 0; margin-bottom: 12px; font-size: 18px; }
        .input-area {
            display: flex;
            gap: 8px;
            background: white;
            padding: 8px;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        #task-input {
            flex: 1;
            padding: 12px 14px;
            font-size: 16px;
            border: 1px solid #e5e5ea;
            border-radius: 10px;
            -webkit-appearance: none;
            outline: none;
        }
        #add-task-btn {
            background-color: #f39c12;
            padding: 12px 20px;
            font-size: 15px;
            border-radius: 10px;
            border: none;
            color: white;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 3px #d68910;
            white-space: nowrap;
        }
        @media (hover: hover) {
            #add-task-btn:hover { box-shadow: 0 5px 12px rgba(0,0,0,0.15); }
        }
        #add-task-btn:active { transform: scale(0.96); }
        .btn-delete { background-color: #95a5a6; box-shadow: 0 3px #7f8c8d; margin-left: 5px; }

        /* æç¤ºæ¡† */
        #message-box {
            position: fixed;
            top: calc(env(safe-area-inset-top, 20px) + 60px);
            left: 50%;
            transform: translateX(-50%);
            padding: 14px 24px;
            border-radius: 14px;
            color: white;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            max-width: 80%;
        }
    </style>
</head>
<body>
    <h1>âš¡ ç”·å­æ±‰è¡Œä¸ºè®­ç»ƒç³»ç»Ÿ âš¡</h1>

    <div id="score-board">
        <div id="rank-title">æ–°å…µ (Private)</div>
        <div class="label">å½“å‰æˆ˜æ–—åŠ›ï¼ˆæ˜Ÿæ˜Ÿï¼‰</div>
        <span id="total-stars">0</span> â­
    </div>
    <div id="message-box"></div>

    <!-- ğŸ¯ åŠ¨æ€ä»»åŠ¡å‘å¸ƒåŒº -->
    <div id="task-publisher">
        <h3>ğŸ¯ å‘å¸ƒè‡ªå®šä¹‰ä»»åŠ¡</h3>
        <div class="input-area">
            <input type="text" id="task-input" placeholder="è¾“å…¥ä»»åŠ¡åç§°ï¼Œä¾‹å¦‚ï¼šå€’åƒåœ¾" />
            <button id="add-task-btn" onclick="addCustomTask()">ğŸ“ å‘å¸ƒ</button>
        </div>
    </div>

    <h2 style="color: var(--danger);">ğŸš¨ è­¦ç¤ºåŒºï¼šè¿è§„æ‰£åˆ†</h2>
    <table>
        <thead class="penalty-header">
            <tr>
                <th width="60%">è¿è§„è¡Œä¸º</th>
                <th width="20%">æƒ©ç½š</th>
                <th width="20%">æ‰§è¡Œ</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>ğŸ˜¡ å¯¹é•¿è¾ˆå¤§å¼å¤§å« / é¡¶å˜´</td>
                <td style="color:#ffe1e1; font-weight:bold;">-20 â­</td>
                <td><button class="btn-minus" onclick="updateScore(-20, 'penalty')">æ‰£åˆ†</button></td>
            </tr>
            <tr>
                <td>ğŸ¢ ç£¨ç£¨è¹­è¹­ï¼Œä¸å®ˆæ—¶é—´</td>
                <td style="color:#ffe1e1; font-weight:bold;">-10 â­</td>
                <td><button class="btn-minus" onclick="updateScore(-10, 'penalty')">æ‰£åˆ†</button></td>
            </tr>
            <tr>
                <td>ğŸ“± æœªç»å…è®¸å·ç©ç”µå­äº§å“</td>
                <td style="color:#ffe1e1; font-weight:bold;">-50 â­</td>
                <td><button class="btn-minus" onclick="updateScore(-50, 'penalty')">é‡ç½š</button></td>
            </tr>
        </tbody>
    </table>

    <h2 style="color: var(--success);">ğŸ›¡ï¸ ä»»åŠ¡åŒºï¼šç§¯ç´¯è£è€€</h2>
    <table>
        <thead class="task-header">
            <tr>
                <th>æŒ‘æˆ˜ä»»åŠ¡</th>
                <th>å¥–åŠ±</th>
                <th>ç¡®è®¤</th>
            </tr>
        </thead>
        <tbody>
            <tr><td colspan="3" class="category">âš”ï¸ æ„å¿—åŠ›æŒ‘æˆ˜ï¼ˆè‡ªå¾‹ï¼‰</td></tr>
            <tr><td>â° ç‹¬ç«‹æŒ‰æ—¶å®Œæˆä½œä¸šï¼ˆä¸ç”¨å‚¬ï¼‰</td><td><b>+5</b> â­</td><td><button class="btn-add" onclick="updateScore(5, 'task')">å®Œæˆ</button> <button class="btn-crit" onclick="updateScore(8, 'critical')">æ€åº¦è¶…å¥½</button></td></tr>
            <tr><td>ğŸ» ä¸“æ³¨ç»ƒç´ï¼ˆä¸å‘è„¾æ°”ï¼‰</td><td><b>+3</b> â­</td><td><button class="btn-add" onclick="updateScore(3, 'task')">å®Œæˆ</button> <button class="btn-crit" onclick="updateScore(5, 'critical')">æ€åº¦è¶…å¥½</button></td></tr>
            
            <tr><td colspan="3" class="category">ğŸ¤ è´£ä»»ä¸æ‹…å½“ï¼ˆè´¡çŒ®ï¼‰</td></tr>
            <tr><td>ğŸ‘¶ å¸¦æ²«æ²«ç©è€ / è®²æ•…äº‹</td><td><b>+10</b> â­</td><td><button class="btn-add" onclick="updateScore(10, 'task')">å®Œæˆ</button> <button class="btn-crit" onclick="updateScore(14, 'critical')">æ€åº¦è¶…å¥½</button></td></tr>
            <tr><td>ğŸ”§ ååŠ©çˆ¸çˆ¸ä¿®ç†/æ¬è¿é‡ç‰©</td><td><b>+15</b> â­</td><td><button class="btn-add" onclick="updateScore(15, 'task')">å®Œæˆ</button> <button class="btn-crit" onclick="updateScore(20, 'critical')">æ€åº¦è¶…å¥½</button></td></tr>
            <tr><td>ğŸš² è´Ÿè´£å®¶åº­æ–°é—»æ’­æŠ¥/æ•´ç†é¤æ¡Œ</td><td><b>+5</b> â­</td><td><button class="btn-add" onclick="updateScore(5, 'task')">å®Œæˆ</button> <button class="btn-crit" onclick="updateScore(8, 'critical')">æ€åº¦è¶…å¥½</button></td></tr>
            
            <tr><td colspan="3" class="category">ğŸ“ æˆ‘çš„è‡ªå®šä¹‰ä»»åŠ¡</td></tr>
        </tbody>
        <tbody id="custom-tasks-body">
            <!-- åŠ¨æ€ä»»åŠ¡å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
        </tbody>
    </table>

    <h2 style="color: var(--info);">ğŸ† æƒç›Šå•†åº—ï¼šç‰¹æƒå…‘æ¢</h2>
    <table>
        <thead class="store-header">
            <tr>
                <th>ç‰¹æƒåç§°</th>
                <th>èŠ±è´¹</th>
                <th>å…‘æ¢</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>ğŸ® ç©æ‰‹æœº 30 åˆ†é’Ÿ</td>
                <td style="color:#ffe1e1; font-weight:bold;">-50 â­</td>
                <td><button class="btn-buy" onclick="updateScore(-50, 'store')">å…‘æ¢</button></td>
            </tr>
            <tr>
                <td>ğŸ‘‘ <b>å‘¨æœ«æŒ‡æŒ¥å®˜</b> (å†³å®šå…¨å®¶å»å“ªç©)</td>
                <td style="color:#ffe1e1; font-weight:bold;">-300 â­</td>
                <td><button class="btn-buy" onclick="updateScore(-300, 'store')">å…‘æ¢</button></td>
            </tr>
            <tr>
                <td>ğŸ› ï¸ <b>å·¥å…·ç®±ä½¿ç”¨æƒ</b> (å’Œçˆ¸çˆ¸ä¸€èµ·)</td>
                <td style="color:#ffe1e1; font-weight:bold;">-100 â­</td>
                <td><button class="btn-buy" onclick="updateScore(-100, 'store')">å…‘æ¢</button></td>
            </tr>
        </tbody>
    </table>

    <script>
        // è¯»å–ä¹‹å‰çš„æ˜Ÿæ˜Ÿï¼ˆå¦‚æœæ²¡æœ‰å°±é»˜è®¤ä¸º0ï¼‰
        let currentScore = parseInt(localStorage.getItem('myStarScore')) || 0;
        const totalStarsEl = document.getElementById('total-stars');
        const rankTitleEl = document.getElementById('rank-title');
        refreshDisplay();

        function updateScore(points, type) {
            // å•†åº—å…‘æ¢æ—¶æ£€æŸ¥ä½™é¢
            if (points < 0 && type === 'store') {
                if (currentScore < 0) {
                    showMessage('âš ï¸ ä¿¡ç”¨ç ´äº§ï¼Œè¯·å…ˆèµšåˆ†', 'error');
                    return;
                }
                if (currentScore + points < 0) {
                    showMessage('âŒ ä½ çš„è£è€€å€¼ä¸è¶³ï¼Œæ— æ³•å…‘æ¢ï¼', 'error');
                    return;
                }
            }

            currentScore += points;
            localStorage.setItem('myStarScore', currentScore);
            refreshDisplay();

            if (type === 'task') {
                showMessage('âš”ï¸ ä»»åŠ¡è¾¾æˆï¼è£è€€ + ' + points, 'success');
                fireworks();
            } else if (type === 'penalty') {
                showMessage('âš ï¸ è¿è§„æ‰£åˆ†ï¼è£è€€ - ' + Math.abs(points), 'error');
            } else if (type === 'store') {
                showMessage('âœ… å…‘æ¢æˆåŠŸï¼', 'info');
            } else if (type === 'critical') {
                showMessage('ğŸ”¥ æ€åº¦æš´å‡»ï¼è£è€€ + ' + points, 'success');
                fireworks();
            }
        }

        function showMessage(text, type) {
            const box = document.getElementById('message-box');
            box.innerText = text;
            box.style.opacity = 1;
            box.style.backgroundColor = type === 'success' ? varSuccess() : (type === 'error' ? varDanger() : varInfo());
            setTimeout(() => { box.style.opacity = 0; }, 2000);
        }

        function varSuccess() { return getComputedStyle(document.documentElement).getPropertyValue('--success'); }
        function varDanger() { return getComputedStyle(document.documentElement).getPropertyValue('--danger'); }
        function varInfo() { return getComputedStyle(document.documentElement).getPropertyValue('--info'); }

        // å†›è¡”ç³»ç»Ÿï¼šæ ¹æ®åˆ†æ•°æ˜¾ç¤ºå†›è¡”
        function getRank(score) {
            if (score < 50) return 'ğŸŒ‘ é¢„å¤‡å…µ (Recruit)';
            if (score < 150) return 'â­ï¸ äºŒç­‰å…µ (Private)';
            if (score < 300) return 'â­ï¸â­ï¸ ä¸‹å£« (Corporal)';
            if (score < 600) return 'ğŸŒ™ ä¸­å£« (Sergeant)';
            if (score < 1000) return 'ğŸŒ™ğŸŒ™ ä¸Šå°‰ (Captain)';
            if (score < 2000) return 'â˜€ï¸ å°‘æ ¡ (Major)';
            return 'ğŸ‘‘ äº”æ˜Ÿä¸Šå°† (General)';
        }
        function updateRank(score) {
            rankTitleEl.innerText = getRank(score);
        }
        function refreshDisplay() {
            totalStarsEl.innerText = currentScore;
            updateRank(currentScore);
            updateStoreFuse();
        }

        // ========== è‡ªå®šä¹‰ä»»åŠ¡ç³»ç»Ÿ ==========
        let customTasks = JSON.parse(localStorage.getItem('customTasks')) || [];

        // æ·»åŠ è‡ªå®šä¹‰ä»»åŠ¡
        function addCustomTask() {
            const input = document.getElementById('task-input');
            const taskName = input.value.trim();
            if (!taskName) {
                showMessage('âš ï¸ è¯·è¾“å…¥ä»»åŠ¡åç§°', 'error');
                return;
            }
            const newTask = {
                id: Date.now(),
                name: taskName,
                points: 10
            };
            customTasks.push(newTask);
            saveCustomTasks();
            renderCustomTasks();
            input.value = '';
            showMessage('âœ… ä»»åŠ¡å·²å‘å¸ƒ', 'success');
        }

        // åˆ é™¤è‡ªå®šä¹‰ä»»åŠ¡
        function deleteCustomTask(taskId) {
            customTasks = customTasks.filter(t => t.id !== taskId);
            saveCustomTasks();
            renderCustomTasks();
            showMessage('ğŸ—‘ï¸ ä»»åŠ¡å·²åˆ é™¤', 'info');
        }

        // ä¿å­˜åˆ° localStorage
        function saveCustomTasks() {
            localStorage.setItem('customTasks', JSON.stringify(customTasks));
        }

        // æ¸²æŸ“è‡ªå®šä¹‰ä»»åŠ¡åˆ—è¡¨
        function renderCustomTasks() {
            const tbody = document.getElementById('custom-tasks-body');
            if (customTasks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="color:#95a5a6; font-style:italic;">æš‚æ— è‡ªå®šä¹‰ä»»åŠ¡ï¼Œå¿«å»å‘å¸ƒä¸€ä¸ªå§ï¼</td></tr>';
                return;
            }
            tbody.innerHTML = customTasks.map(task => `
                <tr>
                    <td>ğŸ“Œ ${task.name}</td>
                    <td><b>+${task.points}</b> â­</td>
                    <td>
                        <button class="btn-add" onclick="updateScore(${task.points}, 'task')">å®Œæˆ</button>
                        <button class="btn-delete" onclick="deleteCustomTask(${task.id})">åˆ é™¤</button>
                    </td>
                </tr>
            `).join('');
        }

        // åˆå§‹åŒ–åŠ è½½è‡ªå®šä¹‰ä»»åŠ¡
        renderCustomTasks();

        // å•†åº—ç†”æ–­ï¼šåˆ†æ•°ä¸ºè´Ÿæ—¶ç¦ç”¨å•†åº—æŒ‰é’®
        function updateStoreFuse() {
            const buyBtns = document.querySelectorAll('.btn-buy');
            const disabled = currentScore < 0;
            buyBtns.forEach(btn => {
                btn.disabled = disabled;
                btn.classList.toggle('disabled', disabled);
            });
            if (disabled) {
                showMessage('âš ï¸ ä¿¡ç”¨ç ´äº§ï¼Œè¯·å…ˆèµšåˆ†', 'error');
            }
        }

        // ç®€å•çƒŸèŠ±æ•ˆæœ
        function fireworks() {
            const count = 180;
            const defaults = { origin: { y: 0.7 } };
            const fire = (particleRatio, opts) => {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            };
            fire(0.25, { spread: 26, startVelocity: 55 });
            fire(0.2, { spread: 60 });
        }
    </script>
</body>
</html>
