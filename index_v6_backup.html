<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¦ è£è€€ç³»ç»Ÿ v6.0 (å®¡æ‰¹ç‰ˆ)</title>
    <link rel="apple-touch-icon" href="https://github.githubassets.com/images/icons/emoji/unicode/1f981.png">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f2f2f7; text-align: center; padding: 20px; padding-top: 50px; color: #1c1c1e;
            -webkit-tap-highlight-color: transparent;
        }

        /* ç™»å½•ç•Œé¢ */
        #login-page { 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center;
            min-height: 80vh; 
        }
        .login-box { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        .btn-login { width: 100%; padding: 15px; background: #007AFF; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px;}

        /* ä¸»ç•Œé¢é€šç”¨ */
        #login-page { display: flex; } /* é»˜è®¤æ˜¾ç¤ºç™»å½•é¡µ */
        #app-page { display: none; } /* é»˜è®¤éšè—ä»»åŠ¡é¡µ */
        .show { display: block !important; animation: fadeIn 0.5s; }
        .hide { display: none !important; }

        .status-bar {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white; padding: 20px; border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); margin-bottom: 25px; position: relative;
        }
        
        .logout-btn { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 15px; border-radius: 8px; font-size: 12px; cursor: pointer; }

        #total-stars { font-size: 60px; font-weight: 800; line-height: 1; }

        .card {
            background: white; border-radius: 18px; padding: 15px; margin-bottom: 15px;
            display: flex; flex-direction: column; gap: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04); text-align: left;
        }
        .card-header { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .card-actions { display: flex; gap: 10px; width: 100%; justify-content: flex-end; flex-wrap: wrap; }
        
        .task-name { font-weight: bold; font-size: 18px; }
        .task-reward { color: #27ae60; font-weight: bold; font-size: 14px; }
        
        button { border: none; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-weight: bold; color: white; font-size: 14px; }
        
        .btn-submit { background-color: #007AFF; width: 100%; } /* å­©å­æäº¤ */
        .btn-approve { background-color: #34c759; } /* çˆ¸çˆ¸é€šè¿‡ */
        .btn-crit { background-color: #ff9500; } /* çˆ¸çˆ¸æš´å‡» */
        .btn-reject { background-color: #ff3b30; } /* çˆ¸çˆ¸é©³å› */
        
        /* å¾…å®¡æ ¸æ ‡è®° */
        .pending-tag { background: #ffcc00; color: #555; padding: 5px 10px; border-radius: 5px; font-size: 12px; font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        #message-box {
            position: fixed; top: 60px; left: 50%; transform: translateX(-50%);
            padding: 12px 24px; border-radius: 20px; color: white; font-weight: bold;
            opacity: 0; transition: opacity 0.5s; z-index: 1000; background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            max-width: 80%;
        }
    </style>
</head>
<body>

    <div id="message-box"></div>

    <div id="login-page">
        <div class="login-box">
            <h2>ğŸ” è£è€€ç³»ç»Ÿç™»å½•</h2>
            <div style="margin-bottom: 20px; color: #888; font-size: 14px;">è¯·é€‰æ‹©èº«ä»½ç™»å½•</div>
            
            <input type="text" id="username" class="login-input" placeholder="è´¦å· (kid / dad)" onkeypress="if(event.key==='Enter') handleLogin()">
            <input type="password" id="password" class="login-input" placeholder="å¯†ç " onkeypress="if(event.key==='Enter') handleLogin()">
            
            <button class="btn-login" onclick="handleLogin()">è¿›å…¥ç³»ç»Ÿ</button>
            <div style="margin-top: 15px; font-size: 12px; color: #aaa;">
                é»˜è®¤å¯†ç ï¼š123456<br>
                å­©å­è´¦å·: kid | çˆ¸çˆ¸è´¦å·: dad
            </div>
        </div>
    </div>

    <div id="app-page">
        <div class="status-bar">
            <div id="rank-badge">å½“å‰å†›è¡”ï¼šæ–°å…µ</div>
            <div><span id="total-stars">0</span> â­</div>
            <div id="user-welcome" style="margin-top: 10px; opacity: 0.8;">æ¬¢è¿å›æ¥</div>
        </div>

        <div id="dad-zone" style="display: none;">
            <h2 style="color: #ff9500; border-left: 5px solid #ff9500; padding-left: 10px;">â³ å¾…å®¡æ‰¹ä»»åŠ¡</h2>
            <div id="pending-list">
                <div style="color: #aaa; padding: 20px;">æš‚æ— å¾…å®¡æ‰¹ä»»åŠ¡</div>
            </div>
            <hr style="margin: 30px 0; border: none; border-top: 1px solid #ddd;">
        </div>

        <h2 style="color: #007AFF; border-left: 5px solid #007AFF; padding-left: 10px;">âš”ï¸ ä»»åŠ¡æŒ‘æˆ˜</h2>
        <div id="task-list"></div>

        <!-- é€€å‡ºæŒ‰é’® -->
        <button style="width: 100%; padding: 15px; background: #95a5a6; color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; margin-top: 30px; cursor: pointer;" onclick="logout()">ğŸšª é€€å‡ºè´¦å·</button>

    </div>

    <script>
        // --- æ•°æ®åˆå§‹åŒ– ---
        let currentScore = parseInt(localStorage.getItem('honorScore_v6')) || 0;
        let pendingTasks = JSON.parse(localStorage.getItem('pendingTasks_v6')) || [];
        let currentUser = null; // 'kid' or 'dad'

        const tasks = [
            { id: 1, name: "ğŸ» ä¸“æ³¨ç»ƒç´ / æ™¨è¯»", reward: 5 },
            { id: 2, name: "ğŸ”§ ååŠ©çˆ¸çˆ¸å¹²æ´»", reward: 10 },
            { id: 3, name: "ğŸ“ ç‹¬ç«‹å®Œæˆä½œä¸š", reward: 5 },
            { id: 4, name: "ğŸ‘¶ å¸¦å¼Ÿå¼Ÿæ²«æ²«", reward: 10 }
        ];

        // --- ç™»å½•é€»è¾‘ ---
        function handleLogin() {
            const user = document.getElementById('username').value.toLowerCase().trim();
            const pass = document.getElementById('password').value.trim();

            if (user === 'kid' && pass === '123456') {
                currentUser = 'kid';
                enterApp();
            } else if (user === 'dad' && pass === '123456') {
                currentUser = 'dad';
                enterApp();
            } else {
                showMessage("è´¦å·æˆ–å¯†ç é”™è¯¯ï¼æç¤º: kid/123456 æˆ– dad/123456", "error");
            }
        }

        function logout() {
            // éšè—ä»»åŠ¡é¡µï¼Œæ˜¾ç¤ºç™»å½•é¡µ
            document.getElementById('app-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'flex';
            currentUser = null;
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function enterApp() {
            // éšè—ç™»å½•é¡µï¼Œæ˜¾ç¤ºä»»åŠ¡é¡µ
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('app-page').style.display = 'block';
            document.getElementById('user-welcome').innerText = (currentUser === 'dad') ? "ğŸ‘¨â€âœˆï¸ ç®¡ç†å‘˜æ¨¡å¼ (çˆ¸çˆ¸)" : "ğŸ§‘â€ğŸš€ æŒ‘æˆ˜è€…æ¨¡å¼ (å„¿å­)";
            
            refreshUI();
        }

        // --- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ ---

        // 1. å­©å­æäº¤ä»»åŠ¡
        function submitTask(taskId, taskName, reward) {
            // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨å®¡æ ¸ä¸­
            const isPending = pendingTasks.find(t => t.uid === taskId + '_pending');
            if(isPending) return showMessage("è¿™ä¸ªä»»åŠ¡æ­£åœ¨å®¡æ ¸ä¸­ï¼Œåˆ«æ€¥ï¼", "error");

            const request = {
                uid: taskId + '_pending', // å”¯ä¸€ID
                name: taskName,
                reward: reward,
                time: new Date().toLocaleTimeString()
            };
            
            pendingTasks.push(request);
            saveData();
            refreshUI();
            showMessage("âœ… å·²æäº¤ç»™çˆ¸çˆ¸å®¡æ ¸ï¼", "success");
        }

        // 2. çˆ¸çˆ¸å®¡æ ¸ - é€šè¿‡
        function approveTask(index, isCrit) {
            const task = pendingTasks[index];
            const finalPoints = isCrit ? Math.floor(task.reward * 1.5 + 2) : task.reward; // æš´å‡»ç®—æ³•

            currentScore += finalPoints;
            pendingTasks.splice(index, 1); // ä»å¾…åŠé‡Œç§»é™¤
            
            saveData();
            refreshUI();
            
            if(isCrit) {
                showMessage(`ğŸ”¥ å®¡æ‰¹é€šè¿‡ï¼æ€åº¦æå¥½ +${finalPoints}`, "success");
                fireworks();
            } else {
                showMessage(`âœ… å®¡æ‰¹é€šè¿‡ +${finalPoints}`, "success");
            }
        }

        // 3. çˆ¸çˆ¸å®¡æ ¸ - é©³å›
        function rejectTask(index) {
            if(confirm("ç¡®å®šé©³å›è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ(è¯´æ˜æ²¡åšå¥½)")) {
                pendingTasks.splice(index, 1);
                saveData();
                refreshUI();
                showMessage("âŒ ä»»åŠ¡è¢«é©³å›", "error");
            }
        }

        // --- ç•Œé¢æ¸²æŸ“ ---
        function refreshUI() {
            document.getElementById('total-stars').innerText = currentScore;
            updateRank();

            // 1. æ¸²æŸ“å®¡æ‰¹åˆ—è¡¨ (åªåœ¨çˆ¸çˆ¸æ¨¡å¼ï¼Œä¸”æœ‰å¾…åŠæ—¶æ˜¾ç¤º)
            const dadZone = document.getElementById('dad-zone');
            const pendingList = document.getElementById('pending-list');
            
            if (currentUser === 'dad') {
                dadZone.style.display = 'block';
                pendingList.innerHTML = '';
                
                if (pendingTasks.length === 0) {
                    pendingList.innerHTML = '<div style="color:#aaa; padding:10px;">æš‚æ— å¾…å®¡æ‰¹ä»»åŠ¡</div>';
                } else {
                    pendingTasks.forEach((task, index) => {
                        pendingList.innerHTML += `
                        <div class="card" style="border-left: 5px solid #ff9500;">
                            <div class="card-header">
                                <span class="task-name">${task.name}</span>
                                <span class="pending-tag">å¾…å®¡æ ¸</span>
                            </div>
                            <div style="font-size:12px; color:#888;">æäº¤æ—¶é—´: ${task.time}</div>
                            <div class="card-actions" style="margin-top:10px;">
                                <button class="btn-reject" onclick="rejectTask(${index})">é©³å›</button>
                                <button class="btn-approve" onclick="approveTask(${index}, false)">é€šè¿‡ (+${task.reward})</button>
                                <button class="btn-crit" onclick="approveTask(${index}, true)">ğŸ”¥ æ€åº¦è¶…å¥½ (+${Math.floor(task.reward * 1.5 + 2)})</button>
                            </div>
                        </div>`;
                    });
                }
            } else {
                dadZone.style.display = 'none';
            }

            // 2. æ¸²æŸ“æ™®é€šä»»åŠ¡åˆ—è¡¨
            const taskList = document.getElementById('task-list');
            taskList.innerHTML = '';
            
            tasks.forEach(task => {
                // æ£€æŸ¥è¿™ä¸ªä»»åŠ¡æ˜¯å¦åœ¨å®¡æ ¸ä¸­
                const isPending = pendingTasks.find(t => t.uid === task.id + '_pending');
                
                let actionHtml = '';
                if (currentUser === 'kid') {
                    if (isPending) {
                        actionHtml = `<button class="btn-submit" style="background:#ccc; cursor:not-allowed;" disabled>â³ ç­‰å¾…çˆ¸çˆ¸å®¡æ ¸...</button>`;
                    } else {
                        actionHtml = `<button class="btn-submit" onclick="submitTask(${task.id}, '${task.name}', ${task.reward})">âœ‹ æˆ‘åšå®Œäº†ï¼ç”³è¯·éªŒæ”¶</button>`;
                    }
                } else {
                    // çˆ¸çˆ¸çœ‹ä»»åŠ¡åˆ—è¡¨ï¼Œå¯èƒ½ä¸éœ€è¦æ“ä½œï¼Œæˆ–è€…å¯ä»¥å¸®ä»–ç›´æ¥å®Œæˆ
                    actionHtml = `<div style="font-size:12px; color:#aaa;">ä»»åŠ¡æ ‡å‡†å¡</div>`;
                }

                taskList.innerHTML += `
                <div class="card">
                    <div class="card-header">
                        <span class="task-name">${task.name}</span>
                        <span class="task-reward">ä»·å€¼ ${task.reward} â­</span>
                    </div>
                    <div style="width:100%; margin-top:10px;">
                        ${actionHtml}
                    </div>
                </div>`;
            });
        }

        function updateRank() {
            let rank = "ğŸŒ‘ é¢„å¤‡å…µ";
            if (currentScore >= 2000) rank = "ğŸ‘‘ äº”æ˜Ÿä¸Šå°†";
            else if (currentScore >= 1000) rank = "â˜€ï¸ å°‘æ ¡";
            else if (currentScore >= 600) rank = "ğŸŒ™ğŸŒ™ ä¸Šå°‰";
            else if (currentScore >= 300) rank = "ğŸŒ™ ä¸­å£«";
            else if (currentScore >= 150) rank = "â­ï¸â­ï¸ ä¸‹å£«";
            else if (currentScore >= 50) rank = "â­ï¸ äºŒç­‰å…µ";
            document.getElementById('rank-badge').innerText = "å½“å‰å†›è¡”ï¼š" + rank;
        }

        function saveData() {
            localStorage.setItem('honorScore_v6', currentScore);
            localStorage.setItem('pendingTasks_v6', JSON.stringify(pendingTasks));
        }

        function showMessage(text, type) {
            const box = document.getElementById('message-box');
            if (!box) return;
            box.innerText = text;
            box.style.opacity = 1;
            box.style.backgroundColor = type === 'success' ? '#34c759' : (type === 'error' ? '#ff3b30' : '#007AFF');
            setTimeout(() => { box.style.opacity = 0; }, 2500);
        }

        function fireworks() { confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); }

        // ç¡®ä¿é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        console.log('è£è€€ç³»ç»Ÿ v6.0 å·²åŠ è½½');
    </script>
</body>
</html>
